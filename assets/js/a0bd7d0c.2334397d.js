"use strict";(self.webpackChunkmegajs_docs=self.webpackChunkmegajs_docs||[]).push([[750],{3905:function(e,n,t){t.d(n,{Zo:function(){return c},kt:function(){return f}});var r=t(7294);function o(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function a(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?a(Object(t),!0).forEach((function(n){o(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):a(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function d(e,n){if(null==e)return{};var t,r,o=function(e,n){if(null==e)return{};var t,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)t=a[r],n.indexOf(t)>=0||(o[t]=e[t]);return o}(e,n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)t=a[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}var s=r.createContext({}),l=function(e){var n=r.useContext(s),t=n;return e&&(t="function"==typeof e?e(n):i(i({},n),e)),t},c=function(e){var n=l(e.components);return r.createElement(s.Provider,{value:n},e.children)},u={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},p=r.forwardRef((function(e,n){var t=e.components,o=e.mdxType,a=e.originalType,s=e.parentName,c=d(e,["components","mdxType","originalType","parentName"]),p=l(t),f=o,m=p["".concat(s,".").concat(f)]||p[f]||u[f]||a;return t?r.createElement(m,i(i({ref:n},c),{},{components:t})):r.createElement(m,i({ref:n},c))}));function f(e,n){var t=arguments,o=n&&n.mdxType;if("string"==typeof e||o){var a=t.length,i=new Array(a);i[0]=p;var d={};for(var s in n)hasOwnProperty.call(n,s)&&(d[s]=n[s]);d.originalType=e,d.mdxType="string"==typeof e?e:o,i[1]=d;for(var l=2;l<a;l++)i[l]=t[l];return r.createElement.apply(null,i)}return r.createElement.apply(null,t)}p.displayName="MDXCreateElement"},1374:function(e,n,t){t.d(n,{Z:function(){return d}});var r=t(7294),o=t(1736),a=t(9877),i=t(8215);t(2263);function d(e){var n=e.version||"0",t=["Node ESM","Node CJS",parseInt(n.split(".")[0])>0?"Browser/Deno":"Browser"],d=[function(e){return e.replace(/\/\/ node2deno:if-deno\n.*\n?/g,"").replace(/\/\/ node2deno:if-node\n/g,"")},function(e){return(e=e.replace(/\/\/ node2deno:if-deno\n.*\n?/g,"").replace(/\/\/ node2deno:if-node\n/g,"")).includes("await ")&&(e=e.replace(/^(?!import|$)/gm,"  ").replace(/^\s*$/m,"\n// Node doesn't support top-level await when using CJS\n;(async function () {").replace(/\n*$/,"\n}()).catch(error => {\n  console.error(error)\n  process.exit(1)\n})\n")),e=e.replace(/import (.+?) from 'megajs'/g,"const $1 = require('megajs')")},function(e){return e.replace(/import (.+?) from 'megajs'/g,'// @deno-types="https://cdn.skypack.dev/megajs@'+n+"/types/es.d.ts\"\nimport $1 from 'https://cdn.skypack.dev/megajs@"+n+"'").replace(/\/\/ node2deno:if-node\n.*\n/g,"").replace(/\/\/ node2deno:if-deno\n/g,"")}];return r.createElement("div",null,r.createElement(a.Z,{groupId:"node2deno",className:"margin-bottom--sm"},t.map((function(n,t){return r.createElement(i.Z,{value:t,label:n,onClick:function(){return setMode(t)},key:"+"+t},r.createElement(o.Z,{language:e.language},d[t](e.code)))}))))}},115:function(e,n,t){t.d(n,{Z:function(){return i}});var r=t(7294),o=t(2389);function a(e){var n=e.children,t=e.fallback;return(0,o.Z)()?r.createElement(r.Fragment,null,n()):t||null}function i(e){return r.createElement(a,{fallback:r.createElement("p",null,"Loading...")},(function(){return r.createElement(d,e)}))}function d(e){if(window.__CPEmbed)setTimeout((function(){return window.__CPEmbed()}),100);else{var n=document.createElement("script");n.src="https://cpwebassets.codepen.io/assets/embed/ei.js",document.head.appendChild(n)}return r.createElement("p",{className:"codepen","data-height":e.height||300,"data-default-tab":e.defaultTab||"js,result","data-slug-hash":e.hash,"data-user":e.user,style:{height:"300px",boxSizing:"border-box",display:"flex",alignItems:"center",justifyContent:"center",border:"2px solid",margin:"1em 0",padding:"1em"}},r.createElement("span",null,"See ",r.createElement("a",{href:"https://codepen.io/"+e.user+"/pen/"+e.hash},"this pen")," on ",r.createElement("a",{href:"https://codepen.io"},"CodePen"),"."))}},9217:function(e,n,t){t.r(n),t.d(n,{assets:function(){return p},contentTitle:function(){return c},default:function(){return g},frontMatter:function(){return l},metadata:function(){return u},toc:function(){return f}});var r=t(7462),o=t(3366),a=(t(7294),t(3905)),i=t(1374),d=t(115),s=["components"],l={sidebar_position:7},c="Interrupted downloads",u={unversionedId:"tutorial/interrupted-downloads",id:"tutorial/interrupted-downloads",title:"Interrupted downloads",description:"If a download gets interrupted - because connection issues or user action - you need to create other stream to resume it:",source:"@site/docs/tutorial/interrupted-downloads.md",sourceDirName:"tutorial",slug:"/tutorial/interrupted-downloads",permalink:"/docs/next/tutorial/interrupted-downloads",editUrl:"https://github.com/qgustavor/megajs-docs/tree/master/docs/tutorial/interrupted-downloads.md",tags:[],version:"current",sidebarPosition:7,frontMatter:{sidebar_position:7},sidebar:"tutorialSidebar",previous:{title:"Downloading files",permalink:"/docs/next/tutorial/downloading"},next:{title:"Network settings",permalink:"/docs/next/tutorial/network-settings"}},p={},f=[],m={toc:f};function g(e){var n=e.components,t=(0,o.Z)(e,s);return(0,a.kt)("wrapper",(0,r.Z)({},m,t,{components:n,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"interrupted-downloads"},"Interrupted downloads"),(0,a.kt)("p",null,"If a download gets interrupted - because connection issues or user action - you need to create other stream to resume it:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"const file = File.fromURL(url)\nfile.loadAttributes(error => {\n  if (error) return console.error(error)\n\n  const start = fs.statSync(file.name).size\n  const downloadStream = file.download({ start })\n\n  const writableStream = fs.createWriteStream(filename, {\n    flags: 'r+', // <= set flags to prevent overwriting the file\n    start\n  })\n\n  downloadStream.pipe(writableStream)\n})\n")),(0,a.kt)("p",null,"The above example assume a Node.js environment, in other environments you might need to convert the Node stream returned by ",(0,a.kt)("inlineCode",{parentName:"p"},"download")," to the way file streaming is handled in this environment (like Deno's ",(0,a.kt)("inlineCode",{parentName:"p"},"Deno.open"),")."),(0,a.kt)("p",null,"Interrupted downloads are not checked due to limitations on MEGA's MAC verification which only works on the entire file contents, but you can verify an already downloaded file using the ",(0,a.kt)("inlineCode",{parentName:"p"},"verify")," function:"),(0,a.kt)(i.Z,{language:"js",code:"import { File, verify } from 'megajs'\n// node2deno:if-node\nimport { createReadStream } from 'node:fs'\n// node2deno:if-deno\nimport { iterateReader } from 'https://cdn.deno.land/std/versions/0.125.0/raw/streams/conversion.ts'\n\n// node2deno:if-node\n// Get a file read stream. createReadStream can be used:\n// node2deno:if-deno\n// Get a file read stream. Deno.open and iterateReader can be used:\n// node2deno:if-node\nconst readStream = createReadStream(filename)\n// node2deno:if-deno\nconst readStream = iterateReader(await Deno.open(filename))\n\nconst file = File.fromURL(url)\nconst verifyStream = verify(file.key)\n\nverifyStream.on('error', error => {\n  // File is corrupted\n})\n\nverifyStream.on('end', () => {\n  // File is OK\n})\n\n// node2deno:if-node\nreadStream.pipe(verifyStream)\n// node2deno:if-deno\nfor await (const data of readStream) {\n// node2deno:if-deno\n  verifyStream.write(data)\n// node2deno:if-deno\n}\n// node2deno:if-deno\nverifyStream.end()",version:"1",mdxType:"CodeBlockSwitchable"}),(0,a.kt)("p",null,"Here is a browser implementation:"),(0,a.kt)(d.Z,{user:"qgustavor",hash:"wvPNNeb",height:"500",mdxType:"CodepenEmbed"}),(0,a.kt)("p",null,"The last part of the tutorial is changing network settings."))}g.isMDXComponent=!0}}]);