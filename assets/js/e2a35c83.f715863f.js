"use strict";(self.webpackChunkmegajs_docs=self.webpackChunkmegajs_docs||[]).push([[87],{3905:function(e,r,t){t.d(r,{Zo:function(){return c},kt:function(){return m}});var n=t(7294);function i(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function a(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function o(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?a(Object(t),!0).forEach((function(r){i(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):a(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function s(e,r){if(null==e)return{};var t,n,i=function(e,r){if(null==e)return{};var t,n,i={},a=Object.keys(e);for(n=0;n<a.length;n++)t=a[n],r.indexOf(t)>=0||(i[t]=e[t]);return i}(e,r);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)t=a[n],r.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(i[t]=e[t])}return i}var l=n.createContext({}),u=function(e){var r=n.useContext(l),t=r;return e&&(t="function"==typeof e?e(r):o(o({},r),e)),t},c=function(e){var r=u(e.components);return n.createElement(l.Provider,{value:r},e.children)},p={inlineCode:"code",wrapper:function(e){var r=e.children;return n.createElement(n.Fragment,{},r)}},d=n.forwardRef((function(e,r){var t=e.components,i=e.mdxType,a=e.originalType,l=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),d=u(t),m=i,f=d["".concat(l,".").concat(m)]||d[m]||p[m]||a;return t?n.createElement(f,o(o({ref:r},c),{},{components:t})):n.createElement(f,o({ref:r},c))}));function m(e,r){var t=arguments,i=r&&r.mdxType;if("string"==typeof e||i){var a=t.length,o=new Array(a);o[0]=d;var s={};for(var l in r)hasOwnProperty.call(r,l)&&(s[l]=r[l]);s.originalType=e,s.mdxType="string"==typeof e?e:i,o[1]=s;for(var u=2;u<a;u++)o[u]=t[u];return n.createElement.apply(null,o)}return n.createElement.apply(null,t)}d.displayName="MDXCreateElement"},4395:function(e,r,t){t.r(r),t.d(r,{frontMatter:function(){return s},contentTitle:function(){return l},metadata:function(){return u},toc:function(){return c},default:function(){return d}});var n=t(7462),i=t(3366),a=(t(7294),t(3905)),o=["components"],s={sidebar_position:3},l="Migrating from V0",u={unversionedId:"migrating-from-v0",id:"migrating-from-v0",title:"Migrating from V0",description:"Most of the changes from V0 to V1 are internal changes, like replacing request with fetch and migrating dependencies, but there were a few breaking changes.",source:"@site/docs/migrating-from-v0.md",sourceDirName:".",slug:"/migrating-from-v0",permalink:"/docs/next/migrating-from-v0",editUrl:"https://github.com/qgustavor/mega-docs/tree/master/docs/migrating-from-v0.md",tags:[],version:"current",sidebarPosition:3,frontMatter:{sidebar_position:3},sidebar:"tutorialSidebar",previous:{title:"API Reference",permalink:"/docs/next/api"}},c=[{value:"Uploading streams without specifying a file size",id:"uploading-streams-without-specifying-a-file-size",children:[],level:2},{value:"There is no request anymore",id:"there-is-no-request-anymore",children:[],level:2},{value:"Downloads and uploads retry on errors",id:"downloads-and-uploads-retry-on-errors",children:[],level:2},{value:"Streaming libraries were updated or replaced",id:"streaming-libraries-were-updated-or-replaced",children:[],level:2}],p={toc:c};function d(e){var r=e.components,t=(0,i.Z)(e,o);return(0,a.kt)("wrapper",(0,n.Z)({},p,t,{components:r,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"migrating-from-v0"},"Migrating from V0"),(0,a.kt)("p",null,"Most of the changes from V0 to V1 are internal changes, like replacing request with fetch and migrating dependencies, but there were a few breaking changes."),(0,a.kt)("h2",{id:"uploading-streams-without-specifying-a-file-size"},"Uploading streams without specifying a file size"),(0,a.kt)("p",null,"Because uploading streams without specifying a file size requires the library to buffer the entire stream in memory and forgetting to specify the file size was a simple mistake to do (even megajs-cli got it wrong) this behavior is not allowed now."),(0,a.kt)("p",null,"Check ",(0,a.kt)("inlineCode",{parentName:"p"},".upload()")," calls and add the ",(0,a.kt)("inlineCode",{parentName:"p"},"size")," argument if missing."),(0,a.kt)("p",null,"If you can't add the ",(0,a.kt)("inlineCode",{parentName:"p"},"size")," argument and prefer the library to do buffering then is possible to restore the old behavior by setting ",(0,a.kt)("inlineCode",{parentName:"p"},"allowUploadBuffering")," to ",(0,a.kt)("inlineCode",{parentName:"p"},"true")," in the ",(0,a.kt)("inlineCode",{parentName:"p"},"upload")," arguments."),(0,a.kt)("h2",{id:"there-is-no-request-anymore"},"There is no request anymore"),(0,a.kt)("p",null,"Check for ",(0,a.kt)("inlineCode",{parentName:"p"},"api.requestModule")," usages in your code and update those to use fetch. There are some shortcuts in V1 which can help, as documented ",(0,a.kt)("a",{parentName:"p",href:"/docs/next/tutorial/network-settings"},"here"),"."),(0,a.kt)("h2",{id:"downloads-and-uploads-retry-on-errors"},"Downloads and uploads retry on errors"),(0,a.kt)("p",null,"Now downloading and uploading will retry up to eight times when downloading or uploading a chunk, defaulting to the following function:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"File.defaultHandleRetries = (tries, error, cb) => {\n  if (tries > 8) {\n    cb(error)\n  } else {\n    setTimeout(cb, 1000 * Math.pow(2, tries))\n  }\n}\n")),(0,a.kt)("p",null,"To restore the behavior from V0 replace the handler to this function"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"File.defaultHandleRetries = (tries, error, cb) => {\n  cb(error)\n}\n")),(0,a.kt)("h2",{id:"streaming-libraries-were-updated-or-replaced"},"Streaming libraries were updated or replaced"),(0,a.kt)("p",null,"It should not cause many issues, but maybe can cause changes in library behavior in case you depended on some Streams1 behavior. It may make the library more responsive than before, after all, the main reason to update those libraries was to fix Deno support."))}d.isMDXComponent=!0}}]);